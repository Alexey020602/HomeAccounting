@page "/Receipts"
@inject IChecksApi ChecksApi
@using global::Receipts.Contracts
@using Microsoft.AspNetCore.Authorization
@using MudBlazor
@using Microsoft.AspNetCore.Components.Web
@inherits Budgets.UI.BudgetPage
@attribute [Authorize]

<PageTitle>Список чеков</PageTitle>
<MudCard>
    <MudCardHeader>
        <MudText Typo="Typo.h1" Color="Color.Primary">Добавленные чеки</MudText>
    </MudCardHeader>
    
    <MudCardContent>
        <MudList T="CheckDto" ReadOnly="true">
            @foreach (var check in LoadedReceipts)
            {
                <MudListItem Value="check">
                    <ReceiptComponent Check="check"/>
                </MudListItem>
                
            }
        </MudList>
    </MudCardContent>
    
</MudCard>
@code {
    private List<CheckDto> LoadedReceipts { get; set; } = [];

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
        LoadedReceipts = await ChecksApi.GetChecks(BudgetId);
        LoadedReceipts.Sort(new DateComparer());
    }

    private sealed class DateComparer : IComparer<CheckDto>
    {
        public int Compare(CheckDto? x, CheckDto? y)
        {
            ArgumentNullException.ThrowIfNull(x);
            ArgumentNullException.ThrowIfNull(y);

            return x.PurchaseDate.CompareTo(y.PurchaseDate);
        }
    }

}